{% extends "base.html" %}
{% block content %}

<a class="btn btn-ghost" href="/mrr/{{ lot.id }}">← Back</a>

<div class="card">
  <div class="runheader">
    <div>
      <h1>Receiving Inspection</h1>
      <div class="muted">
        MRR Ticket #{{ lot.id }} • Type: <b>{{ lot.lot_type }}</b>
      </div>
    </div>
    <div class="actions">
      <span class="pill">Report: <b>{{ inspection_data.report_no }}</b></span>
    </div>
  </div>

  <form method="post" class="mt">

    <div class="card inner">
      <div class="sectiontitle accent-blue">Header (auto-copied from Documentation)</div>

      <div class="grid3 mt">
        <div>
          <label>Report Number</label>
          <input value="{{ inspection_data.report_no }}" readonly>
        </div>

        <div>
          <label>Purchase Order</label>
          <input value="{{ lot.po_number }}" readonly>
        </div>

        <div>
          <label>Delivery Note</label>
          <input name="delivery_note" value="{{ receiving.delivery_note_no if receiving else '' }}" placeholder="DN Number">
        </div>
      </div>

      <div class="grid3 mt">
        <div>
          <label>PO Quantity</label>
          <input value="{{ lot.quantity }} {{ lot.quantity_unit }}" readonly>
        </div>

        <div>
          <label>Quantity Arrived</label>
          <input name="qty_arrived" type="number" step="0.01"
                 value="{{ receiving.qty_arrived if receiving and receiving.qty_arrived is not none else '' }}"
                 required>
        </div>

        <div>
          <label>Unit</label>
          <select name="qty_unit">
            <option value="KG" {% if receiving and receiving.qty_unit=='KG' %}selected{% endif %}>KG</option>
            <option value="T"  {% if receiving and receiving.qty_unit=='T' %}selected{% endif %}>Ton (T)</option>
          </select>
        </div>
      </div>

      <div class="mt">
        <label>
          <input type="checkbox" name="is_partial_delivery" {% if receiving and receiving.is_partial_delivery %}checked{% endif %}>
          Partial delivery (ticket stays open)
        </label>
      </div>

      <div class="mt">
        <label>If quantity mismatch / partial delivery – Reason (required if arrived &gt; PO)</label>
        <textarea name="qty_mismatch_reason" placeholder="Explain mismatch / partial delivery...">{{ receiving.qty_mismatch_reason if receiving else '' }}</textarea>
      </div>
    </div>

    <div class="card inner mt">
      <div class="sectiontitle accent-green">Visual & Physical Inspection (RAW)</div>

      <div class="grid2 mt">
        <div class="fieldbox">
          <label>Packaging condition OK?</label>
          <select name="packaging_ok" required>
            <option value="">-- select --</option>
            <option value="YES">YES</option>
            <option value="NO">NO</option>
          </select>

          <label class="mt">Identification / marking as per specification?</label>
          <select name="marking_ok" required>
            <option value="">-- select --</option>
            <option value="YES">YES</option>
            <option value="NO">NO</option>
          </select>

          <label class="mt">Any physical damage / contamination?</label>
          <select name="damage_ok" required>
            <option value="">-- select --</option>
            <option value="NO_DAMAGE">No damage</option>
            <option value="HAS_DAMAGE">Has issues</option>
          </select>
        </div>

        <div class="fieldbox">
          <label>Quantity matches delivery?</label>
          <select name="qty_ok" required>
            <option value="">-- select --</option>
            <option value="YES">YES</option>
            <option value="NO">NO</option>
          </select>

          <label class="mt">COA / PDS available and acceptable?</label>
          <select name="coa_ok" required>
            <option value="">-- select --</option>
            <option value="YES">YES</option>
            <option value="NO">NO</option>
          </select>

          <label class="mt">Material status</label>
          <select name="material_status" required>
            <option value="">-- select --</option>
            <option value="VERIFIED_CONFIRMED">Verified and Confirmed</option>
            <option value="ON_HOLD">On Hold</option>
            <option value="NON_CONFORMITY">Non-Conformity</option>
          </select>
        </div>
      </div>

      <div class="mt">
        <label>If On Hold / Non-Conformity: Reason / Comments</label>
        <textarea name="hold_comments" placeholder="Write reason / NCR reference / actions..."></textarea>
      </div>
    </div>

    <div class="card inner mt">
      <div class="sectiontitle accent-blue">Remarks</div>

      <label>General remarks</label>
      <textarea name="remarks" placeholder="General remarks..."></textarea>

      <div class="grid2 mt">
        <div>
          <label>Inspected by</label>
          <input name="inspected_by" value="{{ user.display_name }}">
        </div>
        <div>
          <label>&nbsp;</label>
          <button class="btn btn-primary" type="submit">Submit Inspection</button>
        </div>
      </div>
    </div>

  </form>
</div>

{% endblock %}
