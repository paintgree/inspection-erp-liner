{% extends "base.html" %}
{% block content %}

<div class="card">
  <div class="runheader">
    <div>
      <h1>Batch {{ batch_no }}</h1>
      <div class="muted">
        {% if client_name %}{{ client_name }}{% else %}—{% endif %}
        {% if po_number %} • PO: {{ po_number }}{% endif %}
        {% if itp_number %} • ITP: {{ itp_number }}{% endif %}
      </div>
      <div class="mt">
        <span class="pill">Avg progress: {{ avg_progress }}%</span>
      </div>
    </div>

    <div class="actions">
      <a class="btn" href="/dashboard">← Back to Dashboard</a>
      {% if user.role and (user.role|upper == "MANAGER" or user.role|upper == "RUN_CREATOR") %}
        <a class="btn btn-primary" href="/runs/new">+ New Production Run</a>
      {% endif %}
    </div>
  </div>

  <div class="mt tablewrap">
    <table class="table wide">
      <thead>
        <tr>
          <th>Process</th>
          <th>Status</th>
          <th>Progress</th>
          <th class="wrap">Client / Spec</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for r in runs %}
          <tr>
            <td><b>{{ r.process }}</b></td>
            <td>{{ r.status }}</td>
            <td>{{ progress_map.get(r.id, 0) }}%</td>
            <td class="wrap">
              {% if r.pipe_specification %}{{ r.pipe_specification }}{% endif %}
              {% if r.raw_material_spec %}<div class="tiny muted">RM: {{ r.raw_material_spec }}</div>{% endif %}
            </td>
            <td>
              <a class="btn" href="/runs/{{ r.id }}">Open</a>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

</div>

{% endblock %}
