{% extends "base.html" %}
{% block content %}

<div class="page-head">
  <h2>New Burst Test</h2>
  <a class="btn" href="/burst">Back</a>
</div>

<div class="card">

<form method="post" action="/burst/create">

  <h3>Test Mode</h3>
  <div class="mode-tabs">
    <button type="button" id="tabLinked" class="mode-tab active" onclick="setMode('linked')">
      Linked to Cover Production
    </button>
    <button type="button" id="tabManual" class="mode-tab" onclick="setMode('manual')">
      Manual / Unlinked
    </button>
  </div>
  
  <input type="hidden" name="mode" id="modeInput" value="linked">

  <hr/>

  <!-- Linked Section -->
  <div id="linked_section">
    <label>Select Cover Production Run</label>
    <select name="linked_run_id">
      {% for r in runs %}
        {% if r.process == "COVER" %}
          <option value="{{r.id}}">
            {{r.dhtp_batch_no}} - Total {{r.total_length_m}}m
          </option>
        {% endif %}
      {% endfor %}
    </select>
  </div>

  <!-- Manual Section -->
  <div id="manual_section" style="display:none;">
    <label>Batch No</label>
    <input name="manual_batch_no">

    <label>Total Length (m)</label>
    <input name="manual_total_length_m" type="number" step="0.1">
  </div>

  <hr/>

  <h3>Sample Information</h3>

  <div class="grid-2">
    <div>
      <label>Sample Start (m)</label>
      <input name="sample_start_m" type="number" step="0.1" required>
    </div>
    <div>
      <label>Sample Length (m)</label>
      <input name="sample_length_m" type="number" step="0.1" required>
    </div>
  </div>

  <hr/>

  <h3>Test Data</h3>

  <div class="grid-2">
    <div>
      <label>API Class</label>
      <input name="api_class">
    </div>
    <div>
      <label>Test Temp (Â°C)</label>
      <input name="test_temp_c" type="number" step="0.1">
    </div>
  </div>

  <div class="grid-2">
    <div>
      <label>Target Pressure (PSI)</label>
      <input name="target_pressure_psi" type="number">
    </div>
    <div>
      <label>Actual Burst (PSI)</label>
      <input name="actual_burst_psi" type="number">
    </div>
  </div>

  <div class="grid-2">
    <div>
      <label>Time to Burst (sec)</label>
      <input name="time_to_burst_sec" type="number" step="0.1">
    </div>
    <div>
      <label>Failure Mode</label>
      <input name="failure_mode">
    </div>
  </div>

  <label>Notes</label>
  <textarea name="notes" rows="3"></textarea>

  <br/>
  <button class="btn primary" type="submit">Create Burst Test</button>

</form>

</div>

<script>
function setMode(mode){
  document.getElementById('modeInput').value = mode;

  const linked = mode === 'linked';
  document.getElementById('linked_section').style.display = linked ? 'block' : 'none';
  document.getElementById('manual_section').style.display = linked ? 'none' : 'block';

  document.getElementById('tabLinked').classList.toggle('active', linked);
  document.getElementById('tabManual').classList.toggle('active', !linked);
}

// set initial
setMode('linked');
</script>

{% endblock %}
