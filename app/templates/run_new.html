{% extends "base.html" %}
{% block content %}

<div class="page-header">
  <div>
    <h1>Start New Production Run</h1>
    <div class="muted">Process is selected once. Please confirm before saving.</div>
  </div>
  <a class="btn" href="/dashboard">Back</a>
</div>

<form method="post" action="/runs/new" class="card">
  <input type="hidden" name="process" value="{{ process }}" />

  <div class="badge-row">
    <span class="badge large">{{ process }}</span>
    <span class="muted">You are creating a run for this process.</span>
  </div>

  <label>DHTP Batch No. (Run Reference)</label>
  <input name="dhtp_batch_no" required placeholder="Example: A1001065-37"/>

  <div class="grid2">
    <div>
      <label>Total Pipe Length (m) (for progress)</label>
      <input name="total_pipe_length_m" placeholder="Example: 1000" />
    </div>
    <div class="muted" style="align-self:end;">
      Used only for dashboard progress. Can be approximate.
    </div>
  </div>

  <div class="grid2">
    <div><label>Client Name</label><input name="client_name"/></div>
    <div><label>PO Number</label><input name="po_number"/></div>
    <div><label>ITP Number</label><input name="itp_number"/></div>
    <div><label>Pipe Specification</label><input name="pipe_specification"/></div>
    <div><label>Raw Material Spec</label><input name="raw_material_spec"/></div>
    <div><label>Raw Material Batch No</label><input name="raw_material_batch_no"/></div>
  </div>

  <div class="card inner">
    <h2>Machines Used</h2>
    <div class="grid2">
      <div><label>Machine 1 Name</label><input name="m1_name"/></div>
      <div><label>Machine 1 Tag</label><input name="m1_tag"/></div>
      <div><label>Machine 2 Name</label><input name="m2_name"/></div>
      <div><label>Machine 2 Tag</label><input name="m2_tag"/></div>
      <div><label>Machine 3 Name</label><input name="m3_name"/></div>
      <div><label>Machine 3 Tag</label><input name="m3_tag"/></div>
      <div><label>Machine 4 Name</label><input name="m4_name"/></div>
      <div><label>Machine 4 Tag</label><input name="m4_tag"/></div>
    </div>
  </div>

  <div class="card inner">
    <h2>Run Limits (editable)</h2>
    <div class="muted">Manager can edit limits before saving the run.</div>

    {% if error %}
      <div class="alert error">{{ error }}</div>
    {% endif %}

    <div class="table-wrap">
      <table class="tbl">
        <thead>
          <tr>
            <th>Key</th><th>Label</th><th>Unit</th><th>Rule</th><th>Min</th><th>Max</th>
          </tr>
        </thead>
        <tbody>
          {% for d in defaults %}
          <tr>
            <td><input name="p_key" value="{{ d[0] }}" /></td>
            <td><input name="p_label" value="{{ d[1] }}" /></td>
            <td><input name="p_unit" value="{{ d[2] }}" /></td>
            <td>
              <select name="p_rule">
                <option value="RANGE" {% if d[3]=='RANGE' %}selected{% endif %}>RANGE</option>
                <option value="MAX_ONLY" {% if d[3]=='MAX_ONLY' %}selected{% endif %}>MAX_ONLY</option>
                <option value="MIN_ONLY" {% if d[3]=='MIN_ONLY' %}selected{% endif %}>MIN_ONLY</option>
                <option value="INFO_ONLY" {% if d[3]=='INFO_ONLY' %}selected{% endif %}>INFO_ONLY</option>
              </select>
            </td>
            <td><input name="p_min" value="{{ d[4] if d[4] is not none else '' }}" /></td>
            <td><input name="p_max" value="{{ d[5] if d[5] is not none else '' }}" /></td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <button class="btn primary" type="submit">Save Production Run</button>
</form>

{% endblock %}
