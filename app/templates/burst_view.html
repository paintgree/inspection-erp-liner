{% extends "base.html" %}
{% block content %}

<div class="card">
  <h2>Create Burst Test</h2>

  <!-- Tabs -->
  <div class="tab-row" style="margin-bottom:12px;">
    <button type="button" class="tab-btn active" id="tabLinked">Linked to Cover Production</button>
    <button type="button" class="tab-btn" id="tabManual">Manual / Unlinked</button>
  </div>

  <form method="post" action="/burst/create" id="burstCreateForm">
    <!-- Mode -->
    <input type="hidden" name="mode" id="modeField" value="linked">

    <!-- Linked -->
    <div id="linkedSection">
      <label>Select Cover Production Run</label>
      <select name="linked_run_id" required>
        {% for r in cover_runs %}
          <option value="{{ r.id }}">{{ r.run_no }} — {{ r.batch_no }} — Total {{ r.total_length_m }}m</option>
        {% endfor %}
      </select>
    </div>

    <!-- Manual -->
    <div id="manualSection" style="display:none;">
      <label>Batch / Reference</label>
      <input name="manual_batch_no" placeholder="Batch no / reference (optional)">

      <label style="margin-top:10px;">Total Length (m)</label>
      <input name="manual_total_length_m" type="number" step="0.01" value="0">
    </div>

    <!-- We create the report first; details are filled in the burst page -->
    <input type="hidden" name="total_no_of_specimens" value="1">
    <input type="hidden" name="sample_start_m" value="0">
    <input type="hidden" name="sample_length_m" value="0">
    <input type="hidden" name="target_pressure_psi" value="0">
    <input type="hidden" name="test_temp_c" value="0">
    <input type="hidden" name="notes" value="">

    <div style="margin-top:16px;">
      <button class="btn btn-primary" type="submit">Create Burst Test</button>
    </div>
  </form>
</div>

<script>
(function(){
  const tabLinked = document.getElementById("tabLinked");
  const tabManual = document.getElementById("tabManual");
  const linked = document.getElementById("linkedSection");
  const manual = document.getElementById("manualSection");
  const modeField = document.getElementById("modeField");

  function setMode(mode){
    if(mode === "linked"){
      tabLinked.classList.add("active");
      tabManual.classList.remove("active");
      linked.style.display = "block";
      manual.style.display = "none";
      modeField.value = "linked";
      // required on linked dropdown
      const sel = linked.querySelector("select");
      if(sel) sel.required = true;
    } else {
      tabManual.classList.add("active");
      tabLinked.classList.remove("active");
      linked.style.display = "none";
      manual.style.display = "block";
      modeField.value = "manual";
      const sel = linked.querySelector("select");
      if(sel) sel.required = false;
    }
  }

  tabLinked.addEventListener("click", ()=>setMode("linked"));
  tabManual.addEventListener("click", ()=>setMode("manual"));
})();
</script>

{% endblock %}
