{% extends "base.html" %}
{% block content %}

<div class="page-header">
  <div>
    <h1>Dashboard</h1>
    <div class="muted">Runs grouped by Batch Number (Run Reference).</div>
  </div>
  <div class="toolbar">
    <a class="btn" href="/runs/new?process=LINER">+ New Run (Liner)</a>
    <a class="btn" href="/runs/new?process=REINFORCEMENT">+ New Run (Reinforcement)</a>
    <a class="btn" href="/runs/new?process=COVER">+ New Run (Cover)</a>
  </div>
</div>

{% for batch, items in grouped.items() %}
  <div class="card batch-card">
    <div class="batch-header">
      <div>
        <div class="batch-title">Batch: {{ batch }}</div>
        <div class="muted">All processes for this batch</div>
      </div>
    </div>

    <div class="table-wrap">
      <table class="tbl">
        <thead>
          <tr>
            <th>Process</th>
            <th>Status</th>
            <th style="width:260px;">Progress</th>
            <th>Client</th>
            <th>PO</th>
            <th style="width:120px;">Open</th>
          </tr>
        </thead>
        <tbody>
          {% for row in items %}
          <tr>
            <td><span class="badge">{{ row.run.process }}</span></td>
            <td><span class="pill {{ row.run.status|lower }}">{{ row.run.status }}</span></td>

            <td>
              {% if row.percent is not none %}
                <div class="progress-wrap">
                  <div class="progress-bar">
                    <div class="progress-fill" style="width: {{ row.percent }}%;"></div>
                  </div>
                  <div class="progress-text">{{ row.percent }}%</div>
                </div>
              {% else %}
                <span class="muted">No total length</span>
              {% endif %}
            </td>

            <td>{{ row.run.client_name }}</td>
            <td>{{ row.run.po_number }}</td>
            <td><a class="btn small" href="/runs/{{ row.run.id }}">View</a></td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% endfor %}

{% if grouped|length == 0 %}
  <div class="card">
    <div class="muted">No runs yet. Create one to start.</div>
  </div>
{% endif %}

{% endblock %}
