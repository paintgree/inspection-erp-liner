{% extends "base.html" %}
{% block content %}
<a class="btn btn-ghost" href="/runs/{{ run.id }}">← Back</a>

<div class="card">
  <h1>New Inspection Entry — {{ run.process }} / Batch {{ run.dhtp_batch_no }}</h1>

  {% if not has_any %}
    <div class="alert">
      First entry requires: <b>Raw Material Batch No</b> and <b>Inspection Tools</b>.
    </div>
  {% endif %}

  <form method="post" action="/runs/{{ run.id }}/entry/new" class="form">

    <div class="grid2">
      <div>
        <label>Inspection Date</label>
        <input type="date" name="actual_date" required>
      </div>
      <div>
        <label>Actual Inspection Time (HH:MM)</label>
        <input type="time" name="actual_time" required>
      </div>
    </div>

    {% if run.process in ["LINER","COVER"] %}
      <div class="grid2">
        <div><label>Operator 1</label><input name="operator_1"></div>
        <div><label>Operator 2</label><input name="operator_2"></div>
      </div>
    {% else %}
      <div class="grid2">
        <div><label>Operator (Annular 1 & 2)</label><input name="operator_annular_12"></div>
        <div><label>Operator (Int./ Ext. 3 & 4)</label><input name="operator_int_ext_34"></div>
      </div>
    {% endif %}

    <label>Remarks (optional)</label>
    <input name="remarks">

    <div class="card inner mt">
      <h2>Daily Traceability (Tools & Raw Material Batch)</h2>

      <label>Raw Material Batch No (leave blank if unchanged)</label>
      <input name="raw_material_batch_no">

      <div class="grid2 mt">
        <div>
          <label>Tool 1 Name</label><input name="tool1_name">
          <label>Tool 1 Serial</label><input name="tool1_serial">
          <label>Tool 1 Calibration Due (YYYY-MM-DD)</label><input name="tool1_calib_due">
        </div>
        <div>
          <label>Tool 2 Name</label><input name="tool2_name">
          <label>Tool 2 Serial</label><input name="tool2_serial">
          <label>Tool 2 Calibration Due (YYYY-MM-DD)</label><input name="tool2_calib_due">
        </div>
      </div>

      <div class="muted mt">
        This is tracked per day. If tools/raw batch change during the day, enter the new values in the entry where it changed.
      </div>
    </div>

    <div class="card inner mt">
      <h2>Inspection Values</h2>
      <div class="muted">Fill required readings. System places them into correct 2-hour slot automatically.</div>

      <div class="grid2 mt">
        {% for p in params %}
          <div>
            <label>{{ p.label }} {% if p.unit %}({{ p.unit }}){% endif %}</label>
            <input name="param_{{ p.param_key }}" type="number" step="0.001">
          </div>
        {% endfor %}
      </div>
    </div>

    <button class="btn btn-primary" type="submit">Submit Entry</button>
  </form>
</div>
{% endblock %}
