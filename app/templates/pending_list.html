{% extends "base.html" %}
{% block content %}
<a class="btn btn-ghost" href="/runs/{{ run.id }}">‚Üê Back</a>

<div class="card">
  <div class="runheader">
    <div>
      <h1>Pending Approvals ‚Äî {{ run.process }} / Batch {{ run.dhtp_batch_no }}</h1>
      <div class="muted">Approve or Reject edits proposed by inspectors.</div>
    </div>
  </div>

  {% if items|length == 0 %}
    <div class="card inner mt">
      <div class="muted">No pending changes üéâ</div>
    </div>
  {% else %}
    <div class="card inner mt">
      <div class="tablewrap">
        <table class="table wide">
          <thead>
            <tr>
              <th>Date</th>
              <th>Slot</th>
              <th>Parameter</th>
              <th>Old</th>
              <th>Proposed</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for it in items %}
              {% set v = it.value %}
              {% set e = it.entry %}
              {% set p = it.param %}
              <tr>
                <td>{{ e.actual_date if e else "-" }}</td>
                <td>{{ e.slot_time if e else "-" }}</td>
                <td>
                  <b>{{ p.label if p else v.param_key }}</b>
                  {% if p and p.unit %}<span class="muted">{{ p.unit }}</span>{% endif %}
                </td>
                <td>{{ v.value }}</td>
                <td><b>{{ v.pending_value }}</b></td>
                <td style="display:flex; gap:10px;">
                  <form method="post" action="/values/{{ v.id }}/approve"
                        onsubmit="return confirm('Approve this change?');">
                    <button class="btn btn-primary" type="submit">Approve</button>
                  </form>

                  <form method="post" action="/values/{{ v.id }}/reject"
                        onsubmit="return confirm('Reject this change?');">
                    <button class="btn" type="submit">Reject</button>
                  </form>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  {% endif %}
</div>
{% endblock %}
